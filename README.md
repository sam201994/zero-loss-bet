# DoraBag

DoraBag is a Solidity smart contract that allows users to participate in a betting game where they can place bets on the price of Bitcoin. The winner is rewarded with interest and other particpants can withdraw howmuch ever they staked. The contract integrates with various external contracts and services, such as Chainlink's price feed and Aave V2 lending protocol.


## Features

1. Owner starts the bet. The betting round is for `7 days` in which users can place bets or withdraw their funds.
2. Betting round cannot be stopped before `7 days`.
3. Owner stops the bet after the betting period is over and there is a `21 days` lock-in period.
4. Users can place bets on the price of Bitcoin denominated in USD. 
5. Users receive equivalent `DoraToken` for the staked 	`ETH` while placing the bet.
6. The contract tracks multiple betting rounds, each with a defined betting period and lock-in period.
7. Owner declares the winner after the lock-in period is over.
8. The contract determines the winner at the end of the lock-in period based on the closest bet to the actual Bitcoin price. To be eligible to be considered a participant, the user must have at least `1 ETH` staked.
9. Users can withdraw their funds by depositing rqiivalent `DoraToken` which is then burnt.
10. The winner receives `DoraTokens`, which represent their share of the interest generated by the contract's Aave deposits.

## Dependencies

The contract relies on the following external dependencies:

1. [Chainlink](https://docs.chain.link/data-feeds/price-feeds): The contract uses the Chainlink AggregatorV3Interface to fetch the latest price of Bitcoin in USD.

2. OpenZeppelin: The contract imports various libraries and contracts from the OpenZeppelin library, including 
 - Ownable for ownership functionality
 - SafeMath for safe arithmetic operations
 - IERC20 for interacting with ERC20 tokens.

3. [Aave V2](https://docs.aave.com/developers/v/2.0/the-core-protocol/weth-gateway): The contract integrates with the Aave V2 lending protocol to deposit and withdraw ETH. It uses the IAaveV2 interface to interact with the Aave protocol.

## Functionality
The contract provides the following functions:

1. `startBetting()`: Allows the owner of the contract to start a new betting round.
2. `stopBetting()`: Allows the owner to stop betting for the current round after the betting period has expired.
3. `placeBet(uint256 _bitcoinGuesspriceInUSD)`: Allows users to place bets on the Bitcoin price. The function requires a non-zero Bitcoin price guess denominated in USD. Users must send ETH along with their bets, which is then deposited into the Aave lending pool.
4. `withdrawFunds(uint256 _amount)`: Allows users to withdraw their funds after the lock-in period has ended. The function burns the corresponding amount of DoraTokens and transfers the ETH to the caller's address.
5. `findWinner()`: Allowd owner to determine the winner of the current round after the lock-in period has expired. The winner is the user with the closest bet to the actual Bitcoin price. The function calculates the interest earned from Aave deposits and mints DoraTokens for the winner.
6. Various internal functions for auxiliary calculations and interactions with external contracts.

## Usage
To participate in the betting game, users should follow these steps:

1. Start a new betting round by calling `startBetting()` if you are the owner of the contract.
2. Place a bet by calling `placeBet(uint256 _bitcoinGuesspriceInUSD)` and providing a non-zero Bitcoin price guess denominated in USD. Include the desired amount of ETH with the transaction.
3. Wait for the lock-in period to expire.
4. Owner call the `findWinner()` function after lock-in period is expired and determine the winner and receive DoraTokens if eligible.
5. After the lock-in period, call `withdrawFunds(uint256 _amount)` to withdraw your funds and burn the corresponding amount of DoraTokens or let it stay in the contract and carry the stake to the next betting round.

## Prerequisites
Before running the DoraBag contract, make sure you have the following dependencies installed:

1. Solidity compiler version ^0.8.0
2. @chainlink/contracts library version ^0.8.0
3. @openzeppelin/contracts library version ^4.3.0

## Contract Deployment
The contract is deployed on the Ethereum Goerli test network with the following initial parameters:

1. BTC_USD_FEED_ADDRESS: Address of the Chainlink BTC/USD price feed contract on Goerli.
2. LENDING_POOL_ADDRESS: Address of the Aave Lending Pool contract on Goerli.
3. AAVE_V2_ADDRESS: Address of the Aave V2 contract on Goerli.
4. AAVE_ATOKEN_ADDRESS: Address of the Aave aToken contract on Goerli.

The contract deploys a DoraToken instance upon deployment.

**Note**: The contract is currently configured to run on the Goerli test network. Make sure to adjust the addresses

